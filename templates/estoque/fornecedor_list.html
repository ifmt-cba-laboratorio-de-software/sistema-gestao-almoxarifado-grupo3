{% extends 'base.html' %}
{% block title %}Fornecedores • Almoxarifado{% endblock %}

{% block content %}

<div class="row mb-4 align-items-center">
  <div class="col-md-6">
    <h2 class="fw-bold text-dark mb-1">Fornecedores</h2>
    <p class="text-muted mb-0">Parceiros comerciais e empresas cadastradas.</p>
  </div>
  <div class="col-md-6 text-md-end mt-3 mt-md-0">
    {% if perms.estoque.add_fornecedor %}
      <a class="btn btn-primary shadow-sm" href="{% url 'fornecedor_create' %}">
        <i class="bi bi-plus-lg me-1"></i> Novo Fornecedor
      </a>
    {% endif %}
  </div>
</div>

<div class="row mb-4">
  <div class="col-lg-8 mx-auto">
    <div class="card border-0 shadow-sm rounded-pill overflow-hidden">
      <div class="card-body p-1 ps-3 d-flex align-items-center">
        <i class="bi bi-search text-muted me-2"></i>
        <input type="text" class="form-control border-0 shadow-none" 
               name="q" 
               placeholder="Busque por Razão Social, CNPJ ou E-mail..."
               hx-get="{% url 'buscar_fornecedor' %}"
               hx-trigger="keyup changed delay:500ms"
               hx-target="#results-table"
               hx-indicator=".htmx-indicator"
               autocomplete="off">
        <div class="htmx-indicator spinner-border spinner-border-sm text-primary me-3" role="status">
          <span class="visually-hidden">Buscando...</span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="card border-0 shadow-sm rounded-4">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table align-middle table-hover mb-0" style="border-collapse: separate; border-spacing: 0;">
        <thead class="bg-light">
          <tr class="text-secondary text-uppercase small fw-bold">
            <th class="ps-4 py-3 border-bottom">Empresa / Razão Social</th>
            <th class="py-3 border-bottom">Contato</th>
            <th class="py-3 border-bottom">Canais</th>
            <th class="text-end pe-4 py-3 border-bottom">Ações</th>
          </tr>
        </thead>
        <tbody id="results-table">
          {% include 'estoque/partials/tabela_fornecedores.html' %}
        </tbody>
      </table>
    </div>
  </div>
  
  {% if fornecedores.has_other_pages and not request.GET.q %}
  <div class="card-footer bg-white border-top-0 py-3 rounded-bottom-4">
     <nav aria-label="Navegação">
        <ul class="pagination justify-content-center mb-0">
            {% if fornecedores.has_previous %}
              <li class="page-item"><a class="page-link border-0 text-dark" href="?page={{ fornecedores.previous_page_number }}">&laquo; Anterior</a></li>
            {% endif %}
            <li class="page-item disabled"><span class="page-link border-0 text-muted">Página {{ fornecedores.number }} de {{ fornecedores.paginator.num_pages }}</span></li>
            {% if fornecedores.has_next %}
              <li class="page-item"><a class="page-link border-0 text-dark" href="?page={{ fornecedores.next_page_number }}">Próxima &raquo;</a></li>
            {% endif %}
        </ul>
     </nav>
  </div>
  {% endif %}
</div>

{% endblock %}

{% block scripts %}
<script>
  function confirmarExclusao(url, nomeItem) {
    Swal.fire({
      title: 'Remover Fornecedor?',
      text: `Deseja remover '${nomeItem}'? Se houver itens vinculados, a ação será bloqueada.`,
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#eff2f7',
      confirmButtonText: 'Sim, remover',
      cancelButtonText: 'Cancelar',
      customClass: {
        cancelButton: 'text-dark fw-bold'
      },
      reverseButtons: true
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = url;
      }
    })
  }
</script>
{% endblock %}