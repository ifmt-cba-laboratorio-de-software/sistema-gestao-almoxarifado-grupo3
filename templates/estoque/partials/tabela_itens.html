{% load l10n %}

{% for item in items %}
<tr class="bg-white position-relative">
  
  <td class="ps-4 py-3">
    {% if item.quantidade_atual <= item.estoque_minimo %}
      <div class="position-absolute top-0 bottom-0 start-0 bg-danger" style="width: 4px;"></div>
    {% else %}
      <div class="position-absolute top-0 bottom-0 start-0 bg-success" style="width: 4px;"></div>
    {% endif %}

    <div class="d-flex align-items-center">
      <div class="rounded-3 bg-primary bg-opacity-10 text-primary d-flex align-items-center justify-content-center me-3 shadow-sm" style="width: 45px; height: 45px; font-size: 1.2rem;">
        <i class="bi bi-box-seam-fill"></i>
      </div>
      <div>
        <div class="fw-bold text-dark mb-0 d-flex align-items-center gap-2">
          <a href="{% url 'item_detail' item.pk %}" class="text-decoration-none text-dark stretched-link">
            {{ item.descricao }}
          </a>
          <span class="badge bg-light text-secondary border fw-normal">{{ item.codigo }}</span>
        </div>
        <small class="text-muted d-block mt-1">
          Unidade: {{ item.unidade_medida }}
        </small>
      </div>
    </div>
  </td>

  <td class="fw-semibold text-success">
    R$ {{ item.valor_unitario|localize }}
  </td>

  <td>
    {% if item.quantidade_atual <= item.estoque_minimo %}
      <div class="d-flex flex-column">
        <span class="badge bg-danger bg-opacity-10 text-danger border border-danger border-opacity-25 rounded-pill px-3 mb-1 align-self-start">
          <i class="bi bi-exclamation-triangle-fill me-1"></i> Repor Estoque
        </span>
        <small class="text-danger fw-bold" style="font-size: 0.8rem;">
          Restam apenas {{ item.quantidade_atual }}
        </small>
      </div>
    {% else %}
      <div class="d-flex flex-column">
        <span class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25 rounded-pill px-3 mb-1 align-self-start">
          <i class="bi bi-check-circle-fill me-1"></i> Disponível
        </span>
        <small class="text-muted" style="font-size: 0.8rem;">
          {{ item.quantidade_atual }} em estoque (Mín: {{ item.estoque_minimo }})
        </small>
      </div>
    {% endif %}
  </td>

  <td class="text-end pe-4">
    <div class="d-inline-flex gap-2 position-relative" style="z-index: 2;">
      {% if perms.estoque.change_item %}
        <a href="{% url 'item_edit' item.pk %}" class="btn btn-icon btn-light text-primary border-0 bg-primary bg-opacity-10 hover-primary" title="Editar">
          <i class="bi bi-pencil-fill"></i>
        </a>
      {% endif %}
      
      {% if perms.estoque.delete_item %}
        <button type="button" 
                class="btn btn-icon btn-light text-danger border-0 bg-danger bg-opacity-10 hover-danger" 
                title="Excluir"
                data-url="{% url 'item_delete' item.pk %}" 
                data-nome="{{ item.descricao }}" 
                onclick="confirmarExclusao(this.dataset.url, this.dataset.nome)">
          <i class="bi bi-trash-fill"></i>
        </button>
      {% endif %}
    </div>
  </td>
</tr>
{% empty %}
<tr>
  <td colspan="4" class="text-center py-5">
    <div class="text-muted opacity-50">
      <i class="bi bi-inbox fs-1 d-block mb-3"></i>
      <p class="mb-0">Nenhum item encontrado no estoque.</p>
    </div>
  </td>
</tr>
{% endfor %}